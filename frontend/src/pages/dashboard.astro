---
// dashboard.astro
---

<html lang="es">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Dashboard - TurifyTasks</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
				background: #f8fafc;
				min-height: 100vh;
			}

			.header {
				background: #0c5a34;
				color: white;
				padding: 20px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			}

			.header-content {
				max-width: 1200px;
				margin: 0 auto;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.logo {
				display: flex;
				align-items: center;
				gap: 10px;
				font-size: 20px;
				font-weight: bold;
			}

			.logo-icon {
				width: 32px;
				height: 32px;
				background: white;
				border-radius: 8px;
				display: flex;
				align-items: center;
				justify-content: center;
				font-weight: bold;
				color: #0c5a34;
			}

			.user-menu {
				display: flex;
				align-items: center;
				gap: 15px;
			}

			.logout-btn {
				background: rgba(255, 255, 255, 0.2);
				color: white;
				border: none;
				padding: 8px 16px;
				border-radius: 6px;
				cursor: pointer;
				transition: background 0.2s;
			}

			.logout-btn:hover {
				background: rgba(255, 255, 255, 0.3);
			}

			.main-content {
				max-width: 1200px;
				margin: 40px auto;
				padding: 0 20px;
			}

			.welcome-section {
				background: white;
				border-radius: 12px;
				padding: 40px;
				text-align: center;
				box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
				margin-bottom: 30px;
			}

			.welcome-title {
				font-size: 28px;
				color: #1f2937;
				margin-bottom: 10px;
			}

			.welcome-subtitle {
				color: #6b7280;
				font-size: 16px;
			}

			.dashboard-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
				gap: 20px;
			}

			.card {
				background: white;
				border-radius: 12px;
				padding: 24px;
				box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
			}

			.card-title {
				font-size: 18px;
				font-weight: 600;
				color: #1f2937;
				margin-bottom: 12px;
			}

			.card-content {
				color: #6b7280;
				line-height: 1.6;
			}

			.loading-message {
				text-align: center;
				color: #6b7280;
				font-style: italic;
			}
		</style>
	</head>
	<body>
		<header class="header">
			<div class="header-content">
				<div class="logo">
					<div class="logo-icon">✓</div>
					<span>TurifyTasks</span>
				</div>
				<div class="user-menu">
					<span id="userEmail">Cargando...</span>
					<button class="logout-btn" onclick="logout()">Cerrar sesión</button>
				</div>
			</div>
		</header>

		<main class="main-content">
			<div class="welcome-section">
				<h1 class="welcome-title">¡Bienvenido a TurifyTasks!</h1>
				<p class="welcome-subtitle">Gestiona tus tareas de manera eficiente y organizada</p>
			</div>

			<div class="dashboard-grid">
				<div class="card">
					<h2 class="card-title">Bandeja de entrada</h2>
					<div class="card-content">
						<p class="loading-message">Cargando tareas...</p>
					</div>
				</div>

				<div class="card">
					<h2 class="card-title">Tareas de hoy</h2>
					<div class="card-content">
						<p class="loading-message">Cargando tareas del día...</p>
					</div>
				</div>

				<div class="card">
					<h2 class="card-title">Próximas</h2>
					<div class="card-content">
						<p class="loading-message">Cargando próximas tareas...</p>
					</div>
				</div>

				<div class="card">
					<h2 class="card-title">Completadas</h2>
					<div class="card-content">
						<p class="loading-message">Cargando tareas completadas...</p>
					</div>
				</div>
			</div>
		</main>

		<script>
			// Verificar autenticación al cargar la página
			document.addEventListener('DOMContentLoaded', function() {
				checkAuthentication();
			});

			async function checkAuthentication() {
				try {
					const response = await fetch('http://localhost:3000/api/auth/profile', {
						method: 'GET',
						credentials: 'include', // Para cookies de sesión
						headers: {
							'Authorization': `Bearer ${localStorage.getItem('authToken') || ''}`,
							'Content-Type': 'application/json'
						}
					});

					if (response.ok) {
						const data = await response.json();
						const userEmailElement = document.getElementById('userEmail');
						if (userEmailElement) {
							userEmailElement.textContent = data.user?.email || 'Usuario';
						}
					} else {
						// Si no está autenticado, redirigir al login
						window.location.href = '/login';
					}
				} catch (error) {
					console.error('Error verificando autenticación:', error);
					// En caso de error, redirigir al login
					window.location.href = '/login';
				}
			}

			async function logout() {
				try {
					await fetch('http://localhost:3000/api/auth/logout', {
						method: 'POST',
						credentials: 'include',
						headers: {
							'Authorization': `Bearer ${localStorage.getItem('authToken') || ''}`,
							'Content-Type': 'application/json'
						}
					});
				} catch (error) {
					console.error('Error al cerrar sesión:', error);
				} finally {
					// Limpiar token local y redirigir
					localStorage.removeItem('authToken');
					window.location.href = '/login';
				}
			}
		</script>
	</body>
</html>
